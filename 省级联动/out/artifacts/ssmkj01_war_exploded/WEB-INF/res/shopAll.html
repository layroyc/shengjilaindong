<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

    <style>
        #app{
            width: 800px;
            height: 600px;
            border: greenyellow 2px solid;
            margin: 0 auto;
        }
        #wy{
            border: 2px solid black;
            border-collapse: collapse;
            margin: 0 auto;
            margin-top: 18px;
            width: 600px;
            height: 400px;
        }
        table td {
            font-weight: bold;
            padding: 8px;
            border: 2px solid black;
        }
    </style>
</head>
<body>
<div id="app">
    <table id="wy">
        <tr>
            <th colspan="2" align="left">图片信息录入</th>
        </tr>
        <tr>
            <td>图书名</td>
            <td>
                <input type="text" name="bookname" id="bookname">
            </td>
        </tr>
        <tr>
            <td>出版社所在地</td>
            <td>
                <select id="province" onchange="oneProvince()">
                    <option value="1">请选择</option>
                    <option value="湖北">湖北</option>
                    <option value="湖南">湖南</option>
                    <option value="广东">广东</option>
                </select>
                <select id="city">
                    <option value="1">请选择</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>作者</td>
            <td>
                <input type="text" id="author" name="author">
            </td>
        </tr>
        <tr>
            <td>零售价</td>
            <td>
                <input type="text" id="price" name="price">
            </td>
        </tr>
        <tr>
            <td colspan="2" align="left">
                <input type="submit" value="提交" id="addShop" onclick="addShop()">
            </td>
        </tr>

    </table>
</div>

<script>
    function oneProvince() {
        $.ajax({
            url: '/api/address/selectAll',
            type: 'post',
            dataType: 'json',
            success:function (res) {
                console.log(res)
                // 省级选中的状态
                var province=$('#province option:selected').val();
                console.log(province);
                // 湖北省
                var hubei=res.addresss[0].addressname;
                // 湖南省
                var hunan=res.addresss[1].addressname;
                //广东省
                var guangdong=res.addresss[2].addressname;

                if(province == hubei){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 1) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                }
                if(province == hunan){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 2) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                }
                if(province == guangdong){
                    $("#city").empty();
                    $.each(res.addresss, function (index, item) {
                        if (item.parentid == 3) {
                            var optionDom = $("<option value='"+item.addressname+"'>" + item.addressname + "</option>")
                            $("#city").append(optionDom);//ajax异步下拉框
                        }
                    });
                }
            }
        });
    }
    $("#addShop").click(function () {
        // 创建集合 获取所有的id
        var shop = {};
        shop.bookname = $('#bookname').val();
        shop.province = $("#province").find("option:selected").val();
        shop.city=$("#city").find("option:selected").val();
        shop.author = $('#author').val();
        shop.price = $('#price').val();

        $.ajax({
            url:'/api/shop/insert',
            type:'post',
            data:JSON.stringify(shop),
            dataType:'json',
            contentType:"application/json;charset=UTF-8",
            success:function (res) {
                console.log(res)
                if(res == 200){
                    alert(res.msg)
                }
                //location.reload();
            }
        });
    });
</script>
</body>
</html>